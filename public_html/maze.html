<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Land Art</title>
        <meta charset="UTF-8" />
        <style type="text/css">
            #rendering {
                width: 500px;
                height: 500px;
                border: #000000 1px solid;
            }
        </style>
        <script type="text/javascript" src="scripts/paper.js" ></script>
        <script src="scripts/ancestry.js" type="text/javascript"></script>
        <script src="scripts/land-art.js" type="text/javascript"></script>
        <script type="text/javascript">
            
            window.onload = function() {
                //////////////console.log(new Direction(1,2) == Directions.NORTH)
                //paper.install(window);
                var origin = new Coordinates(0, 0);
        
                var canvas = document.getElementById("rendering");
		paper.setup(canvas);
                
		var path = new paper.Path();
                
                var northEastGrid = new Grid(100, 100, 10);
                var ring = new Ring(origin, 50, 100);
                northEastGrid.keepCells(origin, function(coordinates, cell) {
                    var rectangle = cell.toRectangle(coordinates);
                    return ring.contains(rectangle, false);
                });
                
                northEastGrid.buildWalls(function(cell) {
                    return cell.kept ? Directions.all() : Directions.all();
                })
                
                var maze = new Maze();    
                maze.carve(northEastGrid);
                
                northEastGrid = northEastGrid.split(2);
                
                northEastGrid.keepCells(origin, function(coordinates, cell) {
                    var rectangle = cell.toRectangle(coordinates);
                    return ring.contains(rectangle, false);
                });
                northEastGrid.flagCells(origin, function(coordinates, cell) {
                    var rectangle = cell.toRectangle(coordinates);
                    if (ring.contains(rectangle, false)) {
                        if (!cell.isFlaggedWith(Flags.MAZE)) {
                            return Flags.ROUND;
                        }
                    }
                    
                    return null; 
                });
                
                northEastGrid.buildWalls(function(cell) {
                    if (!cell.isFlaggedWith(Flags.MAZE) && cell.isFlaggedWith(Flags.ROUND)) {
                        return Directions.all();
                    } else {
                        return null; 
                    }
                });
                
                //var southEastGrid = northEastGrid.mirror(Axes.HORIZONTAL);
                //var eastGrid = northEastGrid.assemble(southEastGrid, Directions.SOUTH);
                //var westGrid = eastGrid.mirror(Axes.VERTICAL);
                var grid = northEastGrid//eastGrid.assemble(westGrid, Directions.WEST);
                
                
                
                grid.optimizeWalls();
                grid.draw(path, origin);
        
                //ring.draw(path);
                
                paper.view.draw();
            }
            
            function initCanvas(path) {
                
            }
            
            
        </script>
    </head>
    <body>
        <canvas id="rendering"></canvas>
        <p>Maze</p>
    </body>
</html>
